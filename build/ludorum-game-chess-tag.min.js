//! ludorum-game-chess 0.0.1

(function(t){"use strict";this["ludorum-game-chess"]=t(this.base,this.Sermat,this.ludorum,this.chess)}).call(this,function t(n,i,r){"use strict";var o=n.declare,e=(n.obj,n.copy,n.raise,n.raiseIf),s=n.Iterable,a=n.iterable,u=r.Game,c=r.utils.Checkerboard,h=(r.utils.CheckerboardFromString,r.players.UserInterface,{__package__:"ludorum-game-connect4",__name__:"ludorum_game_connect4",__init__:t,__dependencies__:[n,i,r],__SERMAT__:{include:[n,r]}}),l=(h.ChessBoard=o({height:8,width:8,constructor:function(t){this.constructor.arrayToBoard(t,this)},"static arrayToBoard":function(t,n){return n=n||{},"RNBQKBNRPPPPPPPPpppppppprnbqkbnr".split("").forEach(function(i,r){var o=t[r];if(o<255){var e=7&o,s=(56&o)>>3,a=i.toUpperCase();n[e+","+s]={player:a===i?0:1,kind:a,row:e,col:s,flags:flags,index:r}}}),n},toArray:function(){return this.constructor.boardToArray(this)},"static boardToArray":function(t,n){var i;for(var r in n=n||new Uint8Array(32).fill(255),t)n[(i=t[r]).index]=(7&i.col)<<3|7&i.row;return n},isValidPosition:function(t){var n=t[0],i=t[1];return n>=0&&n<this.width&&i>=0&&i<this.height},isEmptyPosition:function(t){return this.isValidPosition(t)&&!this.hasOwnProperty(t[0]+","+t[1])},isPlayersPosition:function(t,n){return this.isValidPosition(t)&&this.hasOwnProperty(t[0]+","+t[1])&&this[t[0]+","+t[1]].player===n},canMoveTo:function(t,n){return this.isValidPosition(t)&&(!this.hasOwnProperty(t[0]+","+t[1])||this[t[0]+","+t[1]].player!==n)},canCaptureAt:function(t,n){return this.isValidPosition(t)&&this.hasOwnProperty(t[0]+","+t[1])&&this[t[0]+","+t[1]].player!==n},forward:function(t){return 0===t?1:-1},rank:function(t,n){return 0===n?t-1:this.height-t},toString:function(){var t=this;return s.range(8).map(function(n){return s.range(8).map(function(i){return piece=t[n+","+i],piece?0===piece.player?piece.kind.toUpperCase():piece.kind.toLowerCase():"."}).join("")}).join("\n")},"dual encodeMove":function(t,n,i,r,o){return((((o&=7)<<3|(t&=7))<<3|(n&=7))<<3|(i&=7))<<3|(r&=7)},"dual decodeMove":function(t){return promotion=t>>10&7,fromRow=t>>9&7,fromCol=t>>6&7,toRow=t>>3&7,toCol=7&t,[[fromRow,fromCol],[toRow,toCol],flags,promotion]},moves_Pawn:function(t){var n=this.forward(t.player),i=[],r=t.row+n;return this.isEmptyPosition([r,t.col])&&i.push(this.encodeMove(t.row,t.col,r,t.col)),t.row===this.rank(2,t.player)&&this.isEmptyPosition([t.row+2*n,t.col])&&i.push(this.encodeMove(t.row,t.col,t.row+2*n,t.col)),this.canCaptureAt([r,t.col-1],t.player)&&i.push(this.encodeMove(t.row,t.col,r,t.col-1)),this.canCaptureAt([r,t.col+1],t.player)&&i.push(this.encodeMove(t.row,t.col,r,t.col+1)),i},moves_Knight:function(t){var n=this,i=t.row,r=t.col;return a([[2,1],[1,2],[2,-1],[-1,2],[-2,-1],[-1,-2],[-2,1],[1,-2]]).filterApply(function(o,e){return n.canMoveTo([i+o,r+e],t.player)},function(t,o){return n.encodeMove(i,r,i+t,r+o)})},moves_Bishop:function(t){var n=this,i=t.row,r=t.col;return a(n.walks([i,r],c.DIRECTIONS.DIAGONAL)).map(function(o){var e=!0;return o.tail().takeWhile(function(i){var r=e&&n.canMoveTo(i,t.player);return e=e&&n.isEmptyPosition(i),r}).map(function(t){return n.encodeMove(i,r,t[0],t[1])})}).flatten()},moves_Rook:function(t){var n=this,i=t.row,r=t.col;return a(n.walks([i,r],c.DIRECTIONS.ORTHOGONAL)).map(function(o){var e=!0;return o.tail().takeWhile(function(i){var r=e&&n.canMoveTo(i,t.player);return e=e&&n.isEmptyPosition(i),r}).map(function(t){return n.encodeMove(i,r,t[0],t[1])})}).flatten()},moves_Queen:function(t){var n=this,i=t.row,r=t.col;return a(n.walks([i,r],c.DIRECTIONS.EVERY)).map(function(o){var e=!0;return o.tail().takeWhile(function(i){var r=e&&n.canMoveTo(i,t.player);return e=e&&n.isEmptyPosition(i),r}).map(function(t){return n.encodeMove(i,r,t[0],t[1])})}).flatten()},moves_King:function(t){var n=this,i=t.row,r=t.col;return a(c.DIRECTIONS.EVERY).filterApply(function(o,e){return n.canMoveTo([i+o,r+e],t.player)},function(t,o){return n.encodeMove(i,r,i+t,i+o)})},apply:function(t){var n=(t="number"==typeof t?this.decodeMove(t):t)[0][0],i=t[0][1],r=t[1][0],o=t[1][1],e=0|t[2],s=0|t[3];return piece=board[n+","+i],delete this[n+","+i],this[r+","+o]=piece,piece.flags=e,s>0&&(piece.kind="PNBRQ".charAt(s)),this}}),h.Chess=o(u,{name:"Chess",players:["White","Black"],constructor:function t(n){n=n||{},u.call(this,n.activePlayer||this.players[0]),this.board=n.board?"string"==typeof n.board?t.boardFromFEN(n.board):n.board:this.initialBoard(),this.castling=n.castling||"KQkq",this.enPassant=n.enPassant,this.halfMoves=0|n.halfMoves,this.fullMoves=Math.max(0|n.fullMoves,1);var i=this;this.pieces=a(this.players).map(function(t){return[t,a(i.kinds).mapApply(function(t,n){return[t,[]]}).toObject()]}).toObject(),a(this.board.pieces).forEachApply(function(t,n){i.pieces[n.player][n.name].push(n)})},moves:function(){if(!this.hasOwnProperty("__moves__")){var t=this,i=this.board,r=this.activePlayer();this.pieces[r].King[0];if(this.checkMoves=[],!(this.checkMoves.length<1))throw new Error("Do not know what to do when in check!");this.__moves__=n.obj(r,a(this.pieces[r]).mapApply(function(t,n){return n}).flatten().map(function(n){return n.moves(t,i)}).flatten().toArray())}return this.__moves__},next:function(t,n,i){e(n,"Haps are not required (given ",n,")!");var r=this.activePlayer(),o=t[r],s=this.board.square(o[1]),a={activePlayer:this.opponent(),board:s.next(this,this.board,o),castling:this.castling,enPassant:null,halfMoves:this.halfMoves,fullMoves:this.fullMoves+("Black"===r?1:0)};return i?(this.constructor(a),this):new this.constructor(a)},result:function(){return this.moves()[this.activePlayer()]?null:this.checkMoves.length>0?this.defeat():this.draw()},"static __SERMAT__":{identifier:"Chess",serializer:function(t){return[t.toFEN()]},materializer:function(t,n){return n?l.fromFEN(n[0]):null}},clone:function(){return l.fromFEN(this.toFEN())},"dual coordFromString":function(t){return[+t.charAt(1)+1,t.charCodeAt(0)-"a".charCodeAt(0)]},"dual coordToString":function(t){return String.fromCharCode("a".charCodeAt(0)+t[1])+(t[0]+1)},toString:function(){return this.toFEN()},toFEN:function(){var t=this.board,n=t.horizontals().map(function(n){var i="",r=0;return n.forEach(function(n){var o=t.square(n);o?(r>0&&(i+=r,r=0),i+=o.toString()):r++}),r>0&&(i+=r),i}).join("/");return n+=" "+this.activePlayer().charAt(0).toLowerCase(),n+=" "+this.castling,n+=" "+(this.enPassant?this.coordToString(this.enPassant):"-"),n+=" "+this.halfMoves+" "+this.fullMoves},"static fromFEN":function(t){t=t.trim();var n=this.FEN_REGEXP.exec(t);return e(!n,"Invalid FEN string '",t,"'!"),new this({board:this.boardFromFEN(n[1]),activePlayer:"w"===n[2]?"White":"Black",castling:"-"===n[3]?"":n[3],enPassant:"-"===n[4]?null:this.coordFromString(n[4]),halfMoves:+n[5],fullMoves:+n[6]})},"static FEN_REGEXP":/^((?:[pnbrqkPNBRQK12345678]+\/){7}[pnbrqkPNBRQK12345678]+)\s+([wb])\s+(-|[KQkq]+)\s+(-|[a-h][1-8])\s+(\d+)\s+(\d+)$/,"dual boardFromFEN":function(t){var n=t.split("/"),i={p:this.kinds.Pawn,n:this.kinds.Knight,b:this.kinds.Bishop,r:this.kinds.Rook,q:this.kinds.Queen,k:this.kinds.King},o=[];return n.forEach(function(t,n){var r=0;a(t).forEach(function(t){isNaN(t)?(o.push(new(i[t.toLowerCase()])(t===t.toLowerCase()?"Black":"White",[n,r])),r++):r+=0|t})}),new r.utils.CheckerboardFromPieces(8,8,o)},"static heuristics":{}}));l.initialBoard=l.prototype.initialBoard=function(){return l.boardFromFEN("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR")},r.games.Chess=l,l.__SERMAT__.identifier=h.__package__+"."+l.__SERMAT__.identifier,h.__SERMAT__.include.push(l),i.include(h);var p=o({constructor:function(t,n){this.player=t,this.position=n},moves:n.objects.unimplemented("Piece","moves(game, board)"),canMove:n.objects.unimplemented("Piece","canMove(game, board, position)"),moveTo:function(t){return new this.constructor(this.player,t)},next:function(t,n,i){return n.clone().__place__(i[1]).__place__(i[2],this.moveTo(i[2]))}}),f=l.kinds=l.prototype.kinds={};return f.Pawn=o(p,{name:"Pawn",moves:function(t,n){var i=this,r=this.player===t.players[0]?-1:1,o=[],e=[this.position[0]+r,this.position[1]];if(n.square(e)||o.push(e),[[r,-1],[r,1]].map(function(t){return[i.position[0]+t[0],i.position[1]+t[1]]}).forEach(function(t){if(n.isValidCoord(t)){var r=n.square(t);r&&r.player!==i.player&&o.push(t)}}),this.position[0]===(r>0?1:n.height-2)&&(e=[this.position[0]+2*r,this.position[1]],n.square(e)||o.push(e)),this.position[0]===(r<0?1:n.height-2)){var s=["Knight","Bishop","Rook","Queen"];return a(o).map(function(t){return s.map(function(n){return["promote",i.position,t,n]})}).flatten()}return a(o).map(function(t){return["move",i.position,t]})},next:function(t,n,i){return"move"===i[0]?p.prototype.next.call(this,t,n,i):n.clone().__place__(i[1]).__place__(i[2],new l.kinds[i[3]](this.player,i[2]))},toString:function(){return"White"===this.player?"P":"p"}}),f.Knight=o(p,{name:"Knight",DELTAS:[[2,1],[1,2],[2,-1],[-1,2],[-2,-1],[-1,-2],[-2,1],[1,-2]],moves:function(t,n){var i=this;return a(this.DELTAS).map(function(t){return["move",i.position,[i.position[0]+t[0],i.position[1]+t[1]]]},function(t){if(n.isValidCoord(t[2])){var r=n.square(t[2]);return!r||r.player!==i.player}return!1})},toString:function(){return"White"===this.player?"N":"n"}}),f.Bishop=o(p,{name:"Bishop",moves:function(t,n){var i=this;return a(n.walks(this.position,c.DIRECTIONS.DIAGONAL)).map(function(t){var r=!0;return t.tail().takeWhile(function(t){var o=n.square(t),e=r&&(!o||o.player!==i.player);return r=r&&!o,e}).map(function(t){return["move",i.position,t]})}).flatten()},next:function(t,n,i){return n.clone().__place__(i[1]).__place__(i[2],new this.constructor(this.player,i[2]))},toString:function(){return"White"===this.player?"B":"b"}}),f.Rook=o(p,{name:"Rook",moves:function(t,n){var i=this;return a(n.walks(this.position,c.DIRECTIONS.ORTHOGONAL)).map(function(t){var r=!0;return t.tail().takeWhile(function(t){var o=n.square(t),e=r&&(!o||o.player!==i.player);return r=r&&!o,e}).map(function(t){return["move",i.position,t]})}).flatten()},toString:function(){return"White"===this.player?"R":"r"}}),f.Queen=o(p,{name:"Queen",moves:function(t,n){var i=this;return a(n.walks(this.position,c.DIRECTIONS.EVERY)).map(function(t){var r=!0;return t.tail().takeWhile(function(t){var o=n.square(t),e=r&&(!o||o.player!==i.player);return r=r&&!o,e}).map(function(t){return["move",i.position,t]})}).flatten()},toString:function(){return"White"===this.player?"Q":"q"}}),f.King=o(p,{name:"King",moves:function(t,n){var i=this;return a(c.DIRECTIONS.EVERY).map(function(t){return["move",i.position,[i.position[0]+t[0],i.position[1]+t[1]]]},function(t){if(n.isValidCoord(t[2])){var r=n.square(t[2]);return!r||r.player!==i.player}return!1})},canMove:function(t,n,i){if(n.isValidCoord(i)&&1===Math.abs(this.position[0]-i[0])!=(1===Math.abs(this.position[1]-i[1]))){var r=n.square(i);return!r||r.player!==this.player}return!1},toString:function(){return"White"===this.player?"K":"k"}}),h});
//# sourceMappingURL=ludorum-game-chess-tag.min.js.map